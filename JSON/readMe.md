## Клиент-серверное приложение JSON 

Логика приложения такая:

+ 1. Сервер каждый раз запоминать данные, которые отправит ему страница. Чтобы убедиться, что данные в порядке, сервер сразу же в ответ будет посылать результат — то, как сервер это запомнил.

+ 2. На клиенте происходит парсер данных, обработка данных и представление их в читаемом виде для пользователя

+ 3. С клиента можно добавить данные, которые сервер должен будет записать в базу данных Json расположенную на сервере 

Состоит из двух частей клиента и сервера.

### сервер

На сервере установлена операционная система ``Apache HTTP-сервер``

Важный момент заключаеться в том, что если сервер заранее всем не сообщит, что он готов работать с запросами, то браузер не даст нашей локальной странице на компьютере получить данные с другого сервера в интернете. Это сделано в целях безопасности, например, чтобы при оплате картой данные не ушли на другой сервер кроме нужного.

Чтобы браузер разрешил нам получать и отправлять данные с сервера, нам нужно настроить сервер. 

Ошибка будет выглядеть так: 

![Image alt](https://github.com/IlyaGall/3mpp1901_ilyaGaluzinskiy/raw/master/JSON/ImgRedme/1.JPG)



Настройка происходит в файле .htaccess: это системный файл, который лежит на сервере и подсказывает серверу, как себя вести в разных ситуациях, интерплетировать можно, как инструкции. Название .htaccess неслучайно: у файла как бы нет имени, но есть расширение .htaccess, и в обычных папках этот файл не будет виден.

Для настройки сервера был создан файл с расширением  ```.htaccess``` . 

прописываем в файл ```.htaccess``` следующие команды:

```htaccess
Header add Access-Control-Allow-Origin "*"
Header add Access-Control-Allow-Headers "origin, x-requested-with, content-type"
Header add Access-Control-Allow-Methods "PUT, GET, POST, DELETE, OPTIONS"
```

+ Первая строка разрешает серверу работать с запросами от любых страниц (хоть это и небезопасно, но это учебный проект поэтому можно). 
+ Вторая строка содержит список разрешённых запросов. 
+ Третья разрешает нужные нам заголовки в запросе.

Фактически этот файл сейчас означает: «разрешаю тебе принимать запросы со всех сайтов, вот такого типа запросы можно принимать, вот такие у них могут быть заголовки». 

```! Файл .htaccess нужно не потерять (на некоторых операционках он станет невидимым, как только сохраняешь его как .htaccess — придётся покопаться в настройках, чтобы его раскрыть). ! ```

Дальше идёт настройка php кода, который отвечает за обработку запросов с клиента.


+ 1. Получаем данные от страницы клиента.
+ 2. Проверяем, есть ли на сервере нужный нам файл с данными —  ```data.json```.
+ 3. Если есть — запоминаем его содержимое, а если такого файла нет — создаём его отдельной командой.

1 вариант:

    + Если пустой запрос, то 4 пункт

2 вариант: 
   
    + Всё, что было в этом файле, переводим в массив, с которым умеет работать PHP. Таким способом у нас каждая JSON-запись будет храниться в отдельной ячейке массива.
    + Добавляем новую запись в этот массив — кладём в него то, что пришло со страницы.
    + Записываем это всё обратно в файл и тут же читаем обратно из него — так мы убедимся, что запись прошла нормально и мы можем с этим работать.
+ 4. Отправляем всё содержимое файла(```data.json) на страницу, чтобы там увидеть, что сервер работает как нужно.

```php
<?php
// на какие данные рассчитан этот скрипт
header("Content-Type: application/json");
// 1. Получаем данные от страницы
$data = json_decode(file_get_contents("php://input"));
if (empty($data)) {
    // 2. Проверяем, есть ли на сервере нужный нам файл с данными — json.data.
    // пустой запрос означает, что юзер попросил отпрвить ему данные для посмотра, код аналогичен ниже, за исключением, что ничего не добовляем в json файл
    // Берём новую переменную и пишем в неё имя файла
    $filename = 'data.json';
    // 3. Если есть — запоминаем его содержимое, а если такого файла нет — создаём его отдельной командой.
    if (file_exists($filename)) {
        // Если файл есть — открываем его и читаем данные
        $file = file_get_contents('data.json');
        // Если такого файла нет…
    } else {
    // …то создаём его сами
        $file = fopen("data.json", "a+");
    }
    echo $file;
    unset($file);
    return;
} 
else{

    // 2. Проверяем, есть ли на сервере нужный нам файл с данными — json.data.
    // Берём новую переменную и пишем в неё имя файла
    $filename = 'data.json';
    // 3. Если есть — запоминаем его содержимое, а если такого файла нет — создаём его отдельной командой.
    if (file_exists($filename)) {
        // Если файл есть — открываем его и читаем данные
        $file = file_get_contents('data.json');
        // Если такого файла нет…
    } else {
    // …то создаём его сами
        $file = fopen("data.json", "a+");
    }
    // 4/ Всё, что было в этом файле, переводим в массив, с которым умеет работать PHP. Таким способом у нас каждая JSON-запись будет храниться в отдельной ячейке массива.
    $taskList = json_decode($file, true);
    // 5. Добавляем новую запись в этот массив — кладём в него то, что пришло со страницы.
    $taskList[] = array($data);
    // 6. Записываем это всё обратно в файл и тут же читаем обратно из него — так мы убедимся, что запись прошла нормально и мы можем с этим работать.
    // Записываем данные в файл…
    file_put_contents('data.json', json_encode($taskList, JSON_UNESCAPED_UNICODE)); //JSON_UNESCAPED_UNICODE без него великий и могучий превращаеться в цифры

    // …и сразу считываем их обратно
    $file = file_get_contents('data.json'); // Открыть файл data.json
    // 7. Отправляем всё содержимое файла на страницу, чтобы там увидеть, что сервер работает как нужно.
    echo $file;
    // Освобождаем память от переменных, которые нам пока не нужны
    unset($file);
    unset($taskList);
}
```

Так же есть простой html файл, который отвечает за загрузку базы данных json на локальное хранилище пользователя важно отметить, что тег ``a href="path file json on server"`` указывает на точное место хранения json файла. Для каждого сервера этот путь уникален

вот его код, который отвечает за загрузку:

```html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>
        Отправляем JSON-данные на сервер
    </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>

<a href="http://xn--80aaklnzueid0i.xn--h1ahn.xn--p1acf/json/data.json" download>Скачать Json файл</a>

</html>
```

### Клиент
разбит на две папки 
+ 1 requestJson отвечает за пустой запрос, который расчитывает получить базу данных без добовления в неё данных со стороны клиента
+ 2 addNewPerson отвечает за добовления новых данных в базу данных
